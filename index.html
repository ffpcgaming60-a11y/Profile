<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VISITOR</title>
    <!-- বাংলা ফন্টের জন্য Google Fonts এবং Tailwind CSS ব্যবহার করা হয়েছে -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* কাস্টম ফন্ট এবং অ্যানিমেশনের জন্য স্টাইল */
        body {
            font-family: 'Noto Sans Bengali', sans-serif;
            margin: 0;
            position: relative;
            overflow-x: hidden;
            min-height: 100vh;
            background-color: #111827;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* ব্যাকগ্রাউন্ড ভিডিওর জন্য নতুন স্টাইল */
        #video-background {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            z-index: -1;
            filter: brightness(0.6);
            object-fit: cover;
        }

        /* মূল কন্টেন্ট অ্যানিমেশন */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .animate-fadeIn {
            animation: fadeIn 1s ease-in-out forwards;
        }

        /* RGB বর্ডার অ্যানিমেশন */
        @keyframes rgbBorderAnimation {
            0% {
                border-color: #ff0000;
            }
            16% {
                border-color: #ff7f00;
            }
            33% {
                border-color: #ffff00;
            }
            50% {
                border-color: #00ff00;
            }
            66% {
                border-color: #0000ff;
            }
            83% {
                border-color: #4b0082;
            }
            100% {
                border-color: #ff0000;
            }
        }

        .rgb-border-animated {
            animation: rgbBorderAnimation 4s linear infinite;
        }

        /* পাসওয়ার্ড ইনপুট বক্সের জন্য নতুন অ্যানিমেশন */
        @keyframes rgbBorderPulse {
            0%, 100% {
                border-color: #ff0000;
                box-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000;
            }
            25% {
                border-color: #00ff00;
                box-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00;
            }
            50% {
                border-color: #0000ff;
                box-shadow: 0 0 10px #0000ff, 0 0 20px #0000ff;
            }
            75% {
                border-color: #ff00ff;
                box-shadow: 0 0 10px #ff00ff, 0 0 20px #ff00ff;
            }
        }

        .rgb-border-pulse-animated {
            animation: rgbBorderPulse 3s linear infinite;
        }

        /* RGB বাটনের জন্য নতুন অ্যানিমেশন - দ্রুত এবং বেশি রঙ যোগ করা হয়েছে */
        @keyframes rgbConicAnimation {
            from {
                background-position: 0% center;
            }
            to {
                background-position: -200% center;
            }
        }

        /* নতুন RGB গ্লো অ্যানিমেশন যোগ করা হয়েছে */
        @keyframes rgbGlowPulse {
            0%, 100% {
                box-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000, 0 0 30px #ff0000;
            }
            25% {
                box-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00, 0 0 30px #00ff00;
            }
            50% {
                box-shadow: 0 0 10px #0000ff, 0 0 20px #0000ff, 0 0 30px #0000ff;
            }
            75% {
                box-shadow: 0 0 10px #ff00ff, 0 0 20px #ff00ff, 0 0 30px #ff00ff;
            }
        }

        .rgb-conic-animated {
            background-image: conic-gradient(
                #ff0000 0%, #ff1a00 1%, #ff3300 2%, #ff4c00 3%, #ff6600 4%,
                #ff8000 5%, #ff9900 6%, #ffb300 7%, #ffcc00 8%, #ffe500 9%,
                #ffff00 10%, #e5ff00 11%, #ccff00 12%, #b3ff00 13%, #99ff00 14%,
                #80ff00 15%, #66ff00 16%, #4cff00 17%, #33ff00 18%, #1aff00 19%,
                #00ff00 20%, #00ff1a 21%, #00ff33 22%, #00ff4c 23%, #00ff66 24%,
                #00ff80 25%, #00ff99 26%, #00ffb3 27%, #00ffcc 28%, #00ffe5 29%,
                #00ffff 30%, #00e5ff 31%, #00ccff 32%, #00b3ff 33%, #0099ff 34%,
                #0080ff 35%, #0066ff 36%, #004cff 37%, #0033ff 38%, #001aff 39%,
                #0000ff 40%, #1a00ff 41%, #3300ff 42%, #4c00ff 43%, #6600ff 44%,
                #8000ff 45%, #9900ff 46%, #b300ff 47%, #cc00ff 48%, #e500ff 49%,
                #ff00ff 50%, #ff00e5 51%, #ff00cc 52%, #ff00b3 53%, #ff0099 54%,
                #ff0080 55%, #ff0066 56%, #ff004c 57%, #ff0033 58%, #ff001a 59%,
                #ff0000 60%, #ff1a00 61%, #ff3300 62%, #ff4c00 63%, #ff6600 64%,
                #ff8000 65%, #ff9900 66%, #ffb300 67%, #ffcc00 68%, #ffe500 69%,
                #ffff00 70%, #e5ff00 71%, #ccff00 72%, #b3ff00 73%, #99ff00 74%,
                #80ff00 75%, #66ff00 76%, #4cff00 77%, #33ff00 78%, #1aff00 79%,
                #00ff00 80%, #00ff1a 81%, #00ff33 82%, #00ff4c 83%, #00ff66 84%,
                #00ff80 85%, #00ff99 86%, #00ffb3 87%, #00ffcc 88%, #00ffe5 89%,
                #00ffff 90%, #00e5ff 91%, #00ccff 92%, #00b3ff 93%, #0099ff 94%,
                #0080ff 95%, #0066ff 96%, #004cff 97%, #0033ff 98%, #001aff 99%,
                #0000ff 100%
            );
            background-size: 200% auto;
            animation: rgbConicAnimation 2s linear infinite;
        }

        /* নতুন RGB টেক্সট অ্যানিমেশন */
        .text-rgb-animated {
            background-image: linear-gradient(
                90deg,
                #ff0000,
                #ff8000,
                #ffff00,
                #00ff00,
                #00ffff,
                #0000ff,
                #ff00ff,
                #ff0000
            );
            background-size: 200% auto;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: rgbConicAnimation 4s linear infinite;
        }

        /* মোবাইলের জন্য ফ্লেক্স লেআউট ঠিক করা হয়েছে */
        @media (max-width: 640px) {
            .ff-profile {
                flex-direction: column;
                text-align: center;
                align-items: center;
            }
        }

        /* স্ট্যাটাস ডটের অ্যানিমেশন */
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
        }

        .status-dot-animated {
            animation: pulse 1.5s infinite;
        }
        
        /* লোডিং স্পিনারের জন্য */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-white">

    <!-- ব্যাকগ্রাউন্ড ভিডিও -->
    <video id="video-background" autoplay loop muted playsinline>
        <source src="https://assets.mixkit.co/videos/preview/mixkit-waving-golden-smoke-1178-large.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <!-- স্প্ল্যাশ স্ক্রিন -->
    <div id="splash-screen" class="fixed inset-0 bg-gray-900 bg-opacity-90 flex flex-col justify-center items-center z-50 transition-opacity duration-500">
        <h1 class="text-white text-5xl md:text-7xl font-extrabold mb-8 animate-pulse">MOBILE X PANEL</h1>
        <button id="ok-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-12 rounded-full shadow-lg transition-transform duration-300 ease-in-out transform hover:scale-110">YES</button>
    </div>

    <!-- মূল কন্টেইনার (লগইন পেজ) -->
    <div id="main-content" class="relative container w-full max-w-xl mx-auto my-5 bg-black bg-opacity-10 backdrop-filter backdrop-blur-sm p-4 md:p-10 rounded-2xl shadow-2xl border-4 border-transparent animate-fadeIn rgb-border-animated hidden">
        
        <!-- প্রোফাইল পিকচার -->
        <div class="flex justify-center">
            <img src="https://i.pinimg.com/736x/47/bd/7f/47bd7fa0f05b3d3ad543443ab73b107b.jpg" alt="Profile Picture" class="w-32 h-32 object-cover rounded-xl border-4 border-transparent mb-5 shadow-lg rgb-border-animated" onerror="this.onerror=null;this.src='https://placehold.co/128x128/333333/ffffff?text=Profile';">
        </div>
        
        <!-- ব্যবহারকারীর নাম -->
        <h1 class="text-4xl md:text-5xl font-bold mb-1 tracking-wide text-center text-rgb-animated">FF PANEL</h1>

        <!-- ডিজিটাল ঘড়ি -->
        <div id="digital-clock" class="text-xl md:text-2xl font-semibold mb-4 text-center text-white"></div>

        <!-- পাসওয়ার্ড ইনপুট এবং মেসেজ বক্স -->
        <div class="mt-5 w-full">
            <input type="password" id="password-input" placeholder="PASSWORD" class="w-full bg-gray-900 bg-opacity-50 text-white px-4 py-3 rounded-lg border-2 border-transparent focus:outline-none focus:border-red-500 transition-all duration-300 rgb-border-pulse-animated">
            <p id="message-box" class="text-center mt-2 font-medium"></p>
        </div>
        
        <!-- পাসওয়ার্ড ভুলে গেছেন বাটন -->
        <div class="w-full text-left my-2">
            <a href="#" id="forgot-password-link" class="text-blue-400 hover:text-blue-600 transition-colors duration-300 text-sm">CHANGE PASSWORD?</a>
        </div>

        <!-- সাবস্ক্রাইব বাটন যা পাসওয়ার্ড যাচাই করবে -->
        <button id="subscribe-button" class="rgb-conic-animated text-white font-bold py-2 px-4 rounded-lg transition-transform duration-300 ease-in-out hover:scale-105 hover:translate-y-[-3px] hover:shadow-xl text-center block w-full">
            <span id="subscribe-text">LOG IN</span>
            <span id="subscribe-spinner" class="loader hidden"></span>
        </button>

        <!-- নতুন ফুটার যা নিচে যোগ করা হয়েছে -->
        <div class="mt-4 px-4 py-2 border-4 rounded-xl text-center rgb-border-animated">
            <h2 class="text-2xl font-extrabold uppercase tracking-wide text-rgb-animated">
                THE BEST MOBILE PANEL FOR U
            </h2>
        </div>
    </div>

    <!-- পাসওয়ার্ড পরিবর্তন করার পেজ (ডিফল্টভাবে লুকানো) -->
    <div id="forgot-password-page" class="hidden relative container w-full max-w-xl mx-auto my-5 bg-black bg-opacity-10 backdrop-filter backdrop-blur-sm p-4 md:p-10 rounded-2xl shadow-2xl border-4 border-transparent animate-fadeIn rgb-border-animated">
        <h2 class="text-3xl font-bold mb-4 text-center">CHANGE PASSWORD</h2>
        <p class="text-center text-gray-400 mb-4">নিরাপত্তার জন্য, প্রথমে আপনার বর্তমান পাসওয়ার্ড দিন এবং তারপর নতুন পাসওয়ার্ডটি দুইবার দিন।</p>
        
        <div class="mb-4">
            <input type="password" id="old-password-input" placeholder="বর্তমান পাসওয়ার্ড" class="w-full bg-gray-900 bg-opacity-50 text-white px-4 py-3 rounded-lg border-2 border-transparent focus:outline-none focus:border-red-500 transition-all duration-300 mb-3">
            <input type="password" id="new-password-input" placeholder="নতুন পাসওয়ার্ড" class="w-full bg-gray-900 bg-opacity-50 text-white px-4 py-3 rounded-lg border-2 border-transparent focus:outline-none focus:border-green-500 transition-all duration-300 mb-3">
            <input type="password" id="confirm-new-password-input" placeholder="নতুন পাসওয়ার্ড নিশ্চিত করুন" class="w-full bg-gray-900 bg-opacity-50 text-white px-4 py-3 rounded-lg border-2 border-transparent focus:outline-none focus:border-green-500 transition-all duration-300">
            <p id="forgot-password-message" class="text-center mt-2 font-medium"></p>
        </div>
        
        <button id="change-password-button" class="rgb-conic-animated text-white font-bold py-2 px-4 rounded-lg transition-transform duration-300 ease-in-out hover:scale-105 hover:translate-y-[-3px] hover:shadow-xl text-center block w-full mb-3">
            <span id="change-password-text">CHANGE PASSWORD</span>
            <span id="change-password-spinner" class="loader hidden"></span>
        </button>
        <button id="back-button" class="text-white font-bold py-2 px-4 rounded-lg transition-transform duration-300 ease-in-out hover:scale-105 hover:translate-y-[-3px] hover:shadow-xl text-center block w-full bg-gray-600 hover:bg-gray-700">ফিরে যান</button>
    </div>

    <!-- নতুন পেজ (লগইন সফল হলে এটি দেখানো হবে) -->
    <div id="new-page" class="hidden relative container w-full max-w-xl mx-auto my-5 bg-black bg-opacity-10 backdrop-filter backdrop-blur-sm p-4 md:p-10 rounded-2xl shadow-2xl border-4 border-transparent animate-fadeIn rgb-border-animated">

        <!-- FF প্রোফাইল সেকশন - এটি নতুন পেজের উপরে থাকবে -->
        <div class="flex items-center justify-between gap-4 bg-gray-900 bg-opacity-50 p-3 md:p-4 rounded-lg shadow-md w-full border-2 border-transparent rgb-border-animated mb-6">
            <div class="flex items-center gap-4">
                <img src="https://www.bing.com/th/id/OIP.zQjlYbWu1YJ4rqQmZrXbEQHaHa?w=201&h=211&c=8&rs=1&qlt=90&o=6&pid=3.1&rm=2" alt="Free Fire Profile Picture" class="w-12 h-12 object-cover rounded-lg border-2 border-red-500" onerror="this.onerror=null;this.src='https://placehold.co/48x48/666666/ffffff?text=FF';">
                <div class="flex flex-col text-left">
                    <span class="text-base font-medium text-white my-1">FF UID: 3746455890</span>
                    <span class="text-base font-medium text-white my-1">NAME: —͞ꜱᴀᴋɪʙᴜʟ !i</span>
                </div>
            </div>
            <span class="flex items-center text-lg font-bold text-green-400">
                <span class="status-dot-animated w-3 h-3 bg-green-400 rounded-full inline-block mr-2"></span>Online Now
            </span>
        </div>

        <!-- দ্বিতীয় পাসওয়ার্ড ইনপুট ক্ষেত্র -->
        <h2 class="text-3xl md:text-4xl font-bold text-center mb-6 text-rgb-animated">PERMAMENT PANEL</h2>
        <p class="text-center text-gray-300 mb-4">
            আপনার নতুন কন্টেন্ট দেখতে নিচের পাসওয়ার্ডটি দিন।
        </p>
        <div class="mt-5 w-full">
            <input type="password" id="new-password-field" placeholder="AUTH KEY PER MOBILE CHANGE" class="w-full bg-gray-900 bg-opacity-50 text-white px-4 py-3 rounded-lg border-2 border-transparent focus:outline-none focus:border-red-500 transition-all duration-300 rgb-border-pulse-animated">
            <p id="new-message-box" class="text-center mt-2 font-medium"></p>
        </div>
        <button id="verify-button" class="rgb-conic-animated text-white font-bold py-2 px-4 rounded-lg transition-transform duration-300 ease-in-out hover:scale-105 hover:translate-y-[-3px] hover:shadow-xl text-center block w-full">
            <span id="verify-text">OPEN FREE FIRE</span>
            <span id="verify-spinner" class="loader hidden"></span>
        </button>

        <!-- লগআউট বাটন -->
        <button id="logout-button" class="text-white font-bold py-2 px-4 rounded-lg transition-transform duration-300 ease-in-out hover:scale-105 hover:translate-y-[-3px] hover:shadow-xl text-center block w-full mt-6 bg-gray-600 hover:bg-gray-700">লগআউট</button>

    </div>

    <!-- JavaScript দিয়ে স্প্ল্যাশ স্ক্রিন এবং মিউজিক নিয়ন্ত্রণ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot, updateDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase Console থেকে আপনার নিজের Firebase Config এখানে পেস্ট করুন।
        // এটি GitHub Pages-এ অ্যাপটি চালানোর জন্য প্রয়োজন।
        // --- এখানে শুরু ---
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        // --- এখানে শেষ ---

        // Canvas পরিবেশের জন্য বিশেষ ভেরিয়েবল
        const canvasFirebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        const canvasAppId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Firebase-এর প্রয়োজনীয় ভেরিয়েবলগুলো সংজ্ঞায়িত করা হয়েছে
        let db, auth;
        let userId;
        let unsubscribeUserDoc;
        let appId;
        
        const isCanvasEnvironment = canvasFirebaseConfig !== null;

        // Firebase Initialization Logic
        async function initializeFirebase() {
            try {
                if (isCanvasEnvironment) {
                    // Canvas Environment-এর জন্য Firebase initialization
                    console.log("Using Canvas authentication.");
                    const app = initializeApp(canvasFirebaseConfig);
                    auth = getAuth(app);
                    db = getFirestore(app);
                    appId = canvasAppId;
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }
                } else if (Object.keys(firebaseConfig).length > 0 && firebaseConfig.apiKey !== "YOUR_API_KEY") {
                    // GitHub Pages বা অন্য কোনো হোস্টিং-এর জন্য
                    console.log("Using user-provided Firebase configuration.");
                    const app = initializeApp(firebaseConfig);
                    auth = getAuth(app);
                    db = getFirestore(app);
                    appId = firebaseConfig.appId;
                    await signInAnonymously(auth);
                } else {
                    console.error("Firebase config is not available. Please provide it to run the app.");
                    // Firebase না থাকলে UI-তে একটি মেসেজ দেখান
                    document.getElementById('message-box').textContent = "Firebase কনফিগারেশন পাওয়া যায়নি। অনুগ্রহ করে কোডে আপনার নিজস্ব কনফিগারেশন যোগ করুন।";
                    document.getElementById('message-box').style.color = "#ef4444";
                    return; // ফাংশন বন্ধ করুন
                }
            } catch (error) {
                console.error("Firebase initialization failed:", error);
            }
        }

        // UI উপাদানগুলো নির্বাচন করা হয়েছে
        const splashScreen = document.getElementById('splash-screen');
        const mainContent = document.getElementById('main-content');
        const newPage = document.getElementById('new-page');
        const forgotPasswordPage = document.getElementById('forgot-password-page');
        const okButton = document.getElementById('ok-btn');
        const audio = new Audio('https://media.memesoundeffects.com/2023/04/interworld-rapture.mp3');

        // লোডিং স্পিনার এবং টেক্সট
        const subscribeButton = document.getElementById('subscribe-button');
        const subscribeText = document.getElementById('subscribe-text');
        const subscribeSpinner = document.getElementById('subscribe-spinner');
        const changePasswordButton = document.getElementById('change-password-button');
        const changePasswordText = document.getElementById('change-password-text');
        const changePasswordSpinner = document.getElementById('change-password-spinner');
        const verifyButton = document.getElementById('verify-button');
        const verifyText = document.getElementById('verify-text');
        const verifySpinner = document.getElementById('verify-spinner');

        // ইনপুট এবং মেসেজ বক্স
        const passwordInput = document.getElementById('password-input');
        const messageBox = document.getElementById('message-box');
        const forgotPasswordLink = document.getElementById('forgot-password-link');
        const oldPasswordInput = document.getElementById('old-password-input');
        const newPasswordInput = document.getElementById('new-password-input');
        const confirmNewPasswordInput = document.getElementById('confirm-new-password-input');
        const backButton = document.getElementById('back-button');
        const forgotPasswordMessage = document.getElementById('forgot-password-message');
        const newPasswordField = document.getElementById('new-password-field');
        const newMessageBox = document.getElementById('new-message-box');
        const logoutButton = document.getElementById('logout-button');
        
        // পাসওয়ার্ড হ্যাশ করার জন্য SHA-256 ফাংশন
        async function sha256(message) {
            const msgBuffer = new TextEncoder('utf-8').encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }

        // লোডিং অবস্থা দেখানোর ফাংশন
        function setLoading(button, textSpan, spinnerSpan, isLoading) {
            if (isLoading) {
                textSpan.classList.add('hidden');
                spinnerSpan.classList.remove('hidden');
                button.disabled = true;
            } else {
                textSpan.classList.remove('hidden');
                spinnerSpan.classList.add('hidden');
                button.disabled = false;
            }
        }
        
        // Firestore-এ ইউজার ডেটা সেট বা আপডেট করার ফাংশন
        async function setUserData(data) {
            if (!userId || !appId || !db) {
                console.error("No user ID, app ID or DB found to set data.");
                return;
            }
            try {
                const userDocRef = doc(db, 'artifacts', appId, 'users', userId);
                await setDoc(userDocRef, data, { merge: true });
            } catch (error) {
                console.error("Error writing document: ", error);
            }
        }

        // Firestore থেকে ইউজার ডেটা রিয়েল-টাইমে নেওয়ার ফাংশন
        function listenToUserDoc() {
            if (unsubscribeUserDoc) {
                unsubscribeUserDoc();
            }
            if (!userId || !db || !appId) {
                console.error("No user ID, DB or app ID to listen to.");
                return;
            }
            const userDocRef = doc(db, 'artifacts', appId, 'users', userId);
            unsubscribeUserDoc = onSnapshot(userDocRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    sessionStorage.setItem('userData', JSON.stringify(data));
                    console.log("User data updated in sessionStorage.");
                } else {
                    console.log("No such document!");
                    sessionStorage.removeItem('userData');
                }
            }, (error) => {
                console.error("Error listening to document: ", error);
            });
        }

        // লগইন লজিক
        async function handleLogin() {
            const enteredPassword = passwordInput.value;
            setLoading(subscribeButton, subscribeText, subscribeSpinner, true);
            const userData = JSON.parse(sessionStorage.getItem('userData'));
            
            if (!userData || !userData.passwordHash) {
                messageBox.textContent = "ডেটা লোড হচ্ছে, কিছুক্ষণ অপেক্ষা করুন।";
                messageBox.style.color = "#fcd34d"; // হলুদ
                setLoading(subscribeButton, subscribeText, subscribeSpinner, false);
                return;
            }
            
            const enteredPasswordHash = await sha256(enteredPassword);
            if (enteredPasswordHash === userData.passwordHash) {
                messageBox.textContent = "";
                mainContent.classList.add('hidden');
                newPage.classList.remove('hidden');
            } else {
                messageBox.textContent = "ভুল পাসওয়ার্ড! আবার চেষ্টা করুন।";
                messageBox.style.color = "#ef4444"; // লাল
            }
            setLoading(subscribeButton, subscribeText, subscribeSpinner, false);
        }

        // পাসওয়ার্ড পরিবর্তন লজিক
        async function handleChangePassword() {
            const oldPassword = oldPasswordInput.value;
            const newPassword = newPasswordInput.value;
            const confirmNewPassword = confirmNewPasswordInput.value;

            const userData = JSON.parse(sessionStorage.getItem('userData'));
            if (!userData || !userData.passwordHash) {
                forgotPasswordMessage.textContent = "ডেটা লোড হচ্ছে, কিছুক্ষণ অপেক্ষা করুন।";
                forgotPasswordMessage.style.color = "#fcd34d";
                return;
            }

            const oldPasswordHash = await sha256(oldPassword);
            if (oldPasswordHash === userData.passwordHash) {
                if (newPassword.trim() === "" || newPassword.length < 4) {
                    forgotPasswordMessage.textContent = "নতুন পাসওয়ার্ড কমপক্ষে ৪ অক্ষরের হতে হবে।";
                    forgotPasswordMessage.style.color = "#ef4444";
                } else if (newPassword !== confirmNewPassword) {
                    forgotPasswordMessage.textContent = "নতুন পাসওয়ার্ড দুটি মিলছে না।";
                    forgotPasswordMessage.style.color = "#ef4444";
                } else {
                    setLoading(changePasswordButton, changePasswordText, changePasswordSpinner, true);
                    const newPasswordHash = await sha256(newPassword);
                    await setUserData({ passwordHash: newPasswordHash });
                    forgotPasswordMessage.textContent = "পাসওয়ার্ড সফলভাবে পরিবর্তন করা হয়েছে!";
                    forgotPasswordMessage.style.color = "#4ade80";
                    setTimeout(() => {
                        mainContent.classList.remove('hidden');
                        forgotPasswordPage.classList.add('hidden');
                        passwordInput.value = '';
                        messageBox.textContent = 'আপনার নতুন পাসওয়ার্ড দিয়ে লগইন করুন।';
                        messageBox.style.color = "#4ade80";
                        setLoading(changePasswordButton, changePasswordText, changePasswordSpinner, false);
                    }, 2000);
                }
            } else {
                forgotPasswordMessage.textContent = "বর্তমান পাসওয়ার্ড ভুল।";
                forgotPasswordMessage.style.color = "#ef4444";
            }
        }

        // দ্বিতীয় পাসওয়ার্ড যাচাই করার লজিক
        async function handleVerify() {
            const enteredPassword2 = newPasswordField.value;
            setLoading(verifyButton, verifyText, verifySpinner, true);
            const userData = JSON.parse(sessionStorage.getItem('userData'));

            if (!userData || !userData.password2) {
                newMessageBox.textContent = "ডেটা লোড হচ্ছে, কিছুক্ষণ অপেক্ষা করুন।";
                newMessageBox.style.color = "#fcd34d";
                setLoading(verifyButton, verifyText, verifySpinner, false);
                return;
            }

            if (enteredPassword2 === userData.password2) {
                newMessageBox.textContent = "সঠিক পাসওয়ার্ড! ইউটিউব চ্যানেলে নিয়ে যাওয়া হচ্ছে...";
                newMessageBox.style.color = "#4ade80";
                
                // এখানে ইউটিউব চ্যানেলে রিডাইরেক্ট করা হচ্ছে
                const youtubeChannelUrl = 'https://www.youtube.com/@xcrawnff-xcf';
                window.open(youtubeChannelUrl, '_blank');
            } else {
                newMessageBox.textContent = "ভুল পাসওয়ার্ড! আবার চেষ্টা করুন।";
                newMessageBox.style.color = "#ef4444";
            }
            setLoading(verifyButton, verifyText, verifySpinner, false);
        }

        // লগআউট লজিক
        function handleLogout() {
            newPage.classList.add('hidden');
            mainContent.classList.remove('hidden');
            passwordInput.value = '';
            messageBox.textContent = '';
            newPasswordField.value = '';
            newMessageBox.textContent = '';
        }

        // রিয়েল-টাইম ঘড়ি আপডেট করার ফাংশন
        function updateClock() {
            const now = new Date();
            let hours = now.getHours();
            let minutes = now.getMinutes();
            let seconds = now.getSeconds();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12;
            minutes = minutes < 10 ? '0' + minutes : minutes;
            seconds = seconds < 10 ? '0' + seconds : seconds;
            const timeString = `${hours}:${minutes}:${seconds} ${ampm}`;
            const clockElement = document.getElementById('digital-clock');
            if (clockElement) {
                clockElement.textContent = timeString;
            }
        }

        // ইভেন্ট লিসেনার
        document.addEventListener('DOMContentLoaded', () => {
            initializeFirebase();
            
            // Firebase Auth State Listener
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                    listenToUserDoc();
                    
                    if (db && appId) {
                        const userDocRef = doc(db, 'artifacts', appId, 'users', userId);
                        const userDocSnap = await getDoc(userDocRef);
                        if (!userDocSnap.exists()) {
                            const defaultPassword = '77777777';
                            const defaultPasswordHash = await sha256(defaultPassword);
                            await setUserData({
                                passwordHash: defaultPasswordHash,
                                password2: '762959814'
                            });
                        }
                    } else {
                        console.error("Database or App ID not initialized after authentication.");
                    }
                } else {
                    console.log("User is signed out or not authenticated.");
                    if (!isCanvasEnvironment) {
                         try {
                             await signInAnonymously(auth);
                         } catch (error) {
                             console.error("Authentication error:", error);
                         }
                    }
                }
            });
        
            // মিউজিক এবং স্প্ল্যাশ স্ক্রিন লজিক
            okButton.addEventListener('click', () => {
                splashScreen.style.display = 'none';
                mainContent.classList.remove('hidden');
                const playPromise = audio.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        console.log("Music started playing automatically.");
                    }).catch(error => {
                        console.error("Audio playback was prevented:", error);
                    });
                }
            });

            // বাটন ইভেন্ট লিসেনার
            subscribeButton.addEventListener('click', handleLogin);
            forgotPasswordLink.addEventListener('click', (event) => {
                event.preventDefault();
                mainContent.classList.add('hidden');
                forgotPasswordPage.classList.remove('hidden');
                oldPasswordInput.value = '';
                newPasswordInput.value = '';
                confirmNewPasswordInput.value = '';
                forgotPasswordMessage.textContent = '';
            });
            changePasswordButton.addEventListener('click', handleChangePassword);
            backButton.addEventListener('click', () => {
                mainContent.classList.remove('hidden');
                forgotPasswordPage.classList.add('hidden');
                passwordInput.value = '';
                messageBox.textContent = '';
            });
            verifyButton.addEventListener('click', handleVerify);
            logoutButton.addEventListener('click', handleLogout);

            // ঘড়ি আপডেট করার জন্য
            updateClock();
            setInterval(updateClock, 1000);
        });
    </script>
</body>
</html>
